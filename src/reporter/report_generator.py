"""
ì¼ì¼ íˆ¬ì ê²°ê³¼ ë¦¬í¬íŠ¸ ìƒì„± ëª¨ë“ˆ

ë¡œê·¸ íŒŒì¼ê³¼ ìš”ì•½ JSON íŒŒì¼ì„ íŒŒì‹±í•˜ì—¬ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ì˜ ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

===============================================================================
[í•™ìŠµ ê°€ì´ë“œ] - ì´ íŒŒì¼ì„ ì½ê¸° ì „ì—
===============================================================================

ğŸ“š ì´ íŒŒì¼ì˜ ì—­í• :
    - ë‹¹ì¼ ê±°ë˜ ë¡œê·¸ë¥¼ íŒŒì‹±í•˜ì—¬ ë§¤ìˆ˜/ë§¤ë„ ë‚´ì—­ì„ ì¶”ì¶œí•©ë‹ˆë‹¤
    - ì†ìµ ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ì—¬ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ì˜ ë¦¬í¬íŠ¸ë¡œ ìƒì„±í•©ë‹ˆë‹¤
    - APSchedulerì— ì˜í•´ ë§¤ì¼ 16:00ì— ìë™ ì‹¤í–‰ë©ë‹ˆë‹¤

ğŸ¯ í•™ìŠµ ëª©í‘œ:
    1. ì •ê·œí‘œí˜„ì‹(Regex)ìœ¼ë¡œ ë¡œê·¸ íŒŒì¼ íŒŒì‹±í•˜ëŠ” ë°©ë²• ë°°ìš°ê¸°
    2. pathlibìœ¼ë¡œ íŒŒì¼ ê²½ë¡œ ë‹¤ë£¨ëŠ” í˜„ëŒ€ì  ë°©ë²• ìµíˆê¸°
    3. ë§ˆí¬ë‹¤ìš´ í…Œì´ë¸” ìƒì„± ë°©ë²• ì´í•´í•˜ê¸°

ğŸ“– ì‚¬ì „ ì§€ì‹:
    - ì •ê·œí‘œí˜„ì‹ ê¸°ì´ˆ (íŒ¨í„´ ë§¤ì¹­ ê°œë…)
    - ë§ˆí¬ë‹¤ìš´ ë¬¸ë²• ê¸°ì´ˆ
    - íŒŒì¼ ì½ê¸°/ì“°ê¸°

ğŸ”— ê´€ë ¨ íŒŒì¼:
    - logs/redarrow_YYYYMMDD.log: ê±°ë˜ ë¡œê·¸ íŒŒì¼
    - logs/summary_YYYYMMDD.json: ì¼ì¼ ìš”ì•½ JSON íŒŒì¼
    - docs/08.Report/: ìƒì„±ëœ ë¦¬í¬íŠ¸ ì €ì¥ ìœ„ì¹˜

ğŸ’¡ í•µì‹¬ ê°œë…:

    [ì •ê·œí‘œí˜„ì‹ (Regular Expression)]
    ë¬¸ìì—´ì—ì„œ íŠ¹ì • íŒ¨í„´ì„ ì°¾ëŠ” ê°•ë ¥í•œ ë„êµ¬ì…ë‹ˆë‹¤.

    ì˜ˆ: r"(\d{4}-\d{2}-\d{2})" â†’ 2024-01-15 í˜•ì‹ì˜ ë‚ ì§œ ë§¤ì¹­

    ê¸°ë³¸ ë¬¸ë²•:
    - \d: ìˆ«ì í•œ ê¸€ì
    - +: 1ê°œ ì´ìƒ ë°˜ë³µ
    - *: 0ê°œ ì´ìƒ ë°˜ë³µ
    - (): ê·¸ë£¹ (ì¶”ì¶œí•  ë¶€ë¶„)
    - []: ë¬¸ì ì§‘í•©

===============================================================================
"""

# ============================================================================
# [í•™ìŠµ í¬ì¸íŠ¸] ëª¨ë“ˆ ì„í¬íŠ¸
# ============================================================================
import re  # ì •ê·œí‘œí˜„ì‹ (Regular Expression) - ë¬¸ìì—´ íŒ¨í„´ ë§¤ì¹­
import json  # JSON íŒŒì¼ ì½ê¸°/ì“°ê¸°
import logging  # ë¡œê¹…
from datetime import datetime  # ë‚ ì§œ/ì‹œê°„ ì²˜ë¦¬
from pathlib import Path  # íŒŒì¼ ê²½ë¡œ ì²˜ë¦¬ (í˜„ëŒ€ì  ë°©ë²•)

logger = logging.getLogger(__name__)

# ============================================================================
# [í•™ìŠµ í¬ì¸íŠ¸] pathlibìœ¼ë¡œ ê²½ë¡œ ì„¤ì •
# ============================================================================
# pathlib.PathëŠ” íŒŒì¼ ê²½ë¡œë¥¼ ê°ì²´ë¡œ ë‹¤ë£¨ëŠ” í˜„ëŒ€ì ì¸ ë°©ë²•ì…ë‹ˆë‹¤.
#
# ì¥ì :
#   - / ì—°ì‚°ìë¡œ ê²½ë¡œ ì—°ê²° (ê°€ë…ì„± ì¢‹ìŒ)
#   - ìš´ì˜ì²´ì œ ë…ë¦½ì  (Windows/Linux/Mac ëª¨ë‘ ì§€ì›)
#   - .exists(), .mkdir() ë“± í¸ë¦¬í•œ ë©”ì„œë“œ ì œê³µ
#
# ì˜ˆì‹œ:
#   Path(__file__)  â†’ í˜„ì¬ íŒŒì¼ ê²½ë¡œ
#   .parent         â†’ ìƒìœ„ í´ë”
#   / "logs"        â†’ í•˜ìœ„ í´ë” ì—°ê²°
# ============================================================================

# í”„ë¡œì íŠ¸ ë£¨íŠ¸ ê¸°ì¤€ ì ˆëŒ€ ê²½ë¡œ
PROJECT_ROOT = Path(__file__).parent.parent.parent  # reporter â†’ src â†’ RedArrow
LOG_DIR = PROJECT_ROOT / "logs"  # ë¡œê·¸ ë””ë ‰í† ë¦¬
REPORT_DIR = PROJECT_ROOT / "docs" / "08.Report"  # ë¦¬í¬íŠ¸ ì €ì¥ ë””ë ‰í† ë¦¬

# íŒŒì¼ëª… í˜•ì‹
LOG_FILE_FORMAT = "redarrow_{}.log"  # ë¡œê·¸ íŒŒì¼ëª… (YYYYMMDD)
SUMMARY_FILE_FORMAT = "summary_{}.json"  # ìš”ì•½ íŒŒì¼ëª…
REPORT_FILE_FORMAT = "{}_íˆ¬ìê²°ê³¼.md"  # ë¦¬í¬íŠ¸ íŒŒì¼ëª… (YYYY-MM-DD)

# ============================================================================
# [í•™ìŠµ í¬ì¸íŠ¸] ì •ê·œí‘œí˜„ì‹ (Regular Expression) íŒ¨í„´
# ============================================================================
# ì •ê·œí‘œí˜„ì‹ì€ ë¬¸ìì—´ì—ì„œ íŠ¹ì • íŒ¨í„´ì„ ì°¾ëŠ” ê°•ë ¥í•œ ë„êµ¬ì…ë‹ˆë‹¤.
#
# ê¸°ë³¸ ë¬¸ë²•:
#   \d      : ìˆ«ì í•œ ê¸€ì (0-9)
#   \d+     : ìˆ«ì 1ê°œ ì´ìƒ
#   .       : ì•„ë¬´ ë¬¸ì 1ê°œ
#   .+      : ì•„ë¬´ ë¬¸ì 1ê°œ ì´ìƒ
#   .+?     : ì•„ë¬´ ë¬¸ì 1ê°œ ì´ìƒ (ìµœì†Œ ë§¤ì¹­, non-greedy)
#   ()      : ê·¸ë£¹ - ì¶”ì¶œí•  ë¶€ë¶„ ì§€ì •
#   []      : ë¬¸ì ì§‘í•© (ì˜ˆ: [\d,]ëŠ” ìˆ«ì ë˜ëŠ” ì½¤ë§ˆ)
#   -       : ë¦¬í„°ëŸ´ í•˜ì´í”ˆ
#
# ì˜ˆì‹œ ë¶„ì„: r"(\d{4}-\d{2}-\d{2})"
#   \d{4}   : ìˆ«ì 4ìë¦¬ (ì—°ë„)
#   -       : í•˜ì´í”ˆ
#   \d{2}   : ìˆ«ì 2ìë¦¬ (ì›”/ì¼)
#   â†’ "2024-01-15" ê°™ì€ ë‚ ì§œ ë§¤ì¹­
#
# re.compile(): íŒ¨í„´ì„ ë¯¸ë¦¬ ì»´íŒŒì¼í•˜ì—¬ ì„±ëŠ¥ í–¥ìƒ
# ============================================================================

# ë¡œê·¸ íŒŒì‹± íŒ¨í„´ (ì‹¤ì œ ê±°ë˜ ì´ë²¤íŠ¸ë§Œ ë§¤ì¹­)
# ë§¤ìˆ˜: "âœ… ë§¤ìˆ˜ ì£¼ë¬¸ ì ‘ìˆ˜ ì„±ê³µ: {ì¢…ëª©ëª…} {ìˆ˜ëŸ‰}ì£¼ @ {ê°€ê²©}ì› (ì£¼ë¬¸ë²ˆí˜¸: {ë²ˆí˜¸})"
BUY_PATTERN = re.compile(
    r"(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}),\d+ - .+ - INFO - "  # íƒ€ì„ìŠ¤íƒ¬í”„
    r"âœ… ë§¤ìˆ˜ ì£¼ë¬¸ ì ‘ìˆ˜ ì„±ê³µ: (.+?) (\d+)ì£¼ @ ([\d,]+)ì›"  # ì¢…ëª©ëª…, ìˆ˜ëŸ‰, ê°€ê²©
)

# ë§¤ë„: "âœ… ë§¤ë„ ì£¼ë¬¸ ì²´ê²° ì„±ê³µ: {ì¢…ëª©ëª…} {ìˆ˜ëŸ‰}ì£¼ @ {ê°€ê²©}ì› (ì£¼ë¬¸ë²ˆí˜¸: {ë²ˆí˜¸})"
SELL_PATTERN = re.compile(
    r"(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}),\d+ - .+ - INFO - "
    r"âœ… ë§¤ë„ ì£¼ë¬¸ ì²´ê²° ì„±ê³µ: (.+?) (\d+)ì£¼ @ ([\d,]+)ì›"
)

# ì²­ì‚°: "âœ… ì²­ì‚° ì£¼ë¬¸ ì²´ê²° ì„±ê³µ: {ì¢…ëª©ëª…} {ìˆ˜ëŸ‰}ì£¼, ì§„ì…ê°€ {ê°€ê²©}ì›, ì²­ì‚°ê°€ {ê°€ê²©}ì›"
LIQUIDATION_PATTERN = re.compile(
    r"(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}),\d+ - .+ - INFO - "
    r"âœ… ì²­ì‚° ì£¼ë¬¸ ì²´ê²° ì„±ê³µ: (.+?) (\d+)ì£¼, ì§„ì…ê°€ ([\d,]+)ì›, ì²­ì‚°ê°€ ([\d,]+)ì›"
)

# ì†ìµ: "ğŸ’° ì²­ì‚° ì†ìµ: {ê¸ˆì•¡}ì› ({ë¹„ìœ¨}%)"
PNL_PATTERN = re.compile(
    r"(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}),\d+ - .+ - INFO - "
    r"ğŸ’° ì²­ì‚° ì†ìµ: ([\d,.-]+)ì› \(([\d.+-]+)%\)"
)


def setup_reporter():
    """ë¦¬í¬íŠ¸ ë””ë ‰í† ë¦¬ê°€ ì—†ìœ¼ë©´ ìƒì„±í•©ë‹ˆë‹¤."""
    REPORT_DIR.mkdir(parents=True, exist_ok=True)


def parse_summary_file(date_str: str):
    """
    í•´ë‹¹ ë‚ ì§œì˜ ìš”ì•½ JSON íŒŒì¼ì„ íŒŒì‹±í•©ë‹ˆë‹¤.

    Args:
        date_str: YYYYMMDD í˜•ì‹ì˜ ë‚ ì§œ ë¬¸ìì—´

    Returns:
        ìš”ì•½ ë°ì´í„° ë”•ì…”ë„ˆë¦¬ ë˜ëŠ” None
    """
    summary_file_path = LOG_DIR / SUMMARY_FILE_FORMAT.format(date_str)
    if not summary_file_path.exists():
        logger.warning(f"ìš”ì•½ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {summary_file_path}")
        return None

    try:
        with open(summary_file_path, 'r', encoding='utf-8') as f:
            return json.load(f)
    except Exception as e:
        logger.error(f"ìš”ì•½ íŒŒì¼ íŒŒì‹± ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}")
        return None


def parse_log_file(date_str: str):
    """
    í•´ë‹¹ ë‚ ì§œì˜ ë¡œê·¸ íŒŒì¼ì—ì„œ ì‹¤ì œ ê±°ë˜ ì´ë²¤íŠ¸ë§Œ ì¶”ì¶œí•©ë‹ˆë‹¤.

    Args:
        date_str: YYYYMMDD í˜•ì‹ì˜ ë‚ ì§œ ë¬¸ìì—´

    Returns:
        (buy_events, sell_events, pnl_events) íŠœí”Œ
        - buy_events: [{'time': str, 'name': str, 'quantity': int, 'price': str}, ...]
        - sell_events: [{'time': str, 'name': str, 'quantity': int, 'price': str, 'type': str}, ...]
        - pnl_events: [{'time': str, 'amount': str, 'percent': str}, ...]
    """
    # ========================================================================
    # [í•™ìŠµ í¬ì¸íŠ¸] ë¡œê·¸ íŒŒì¼ íŒŒì‹±
    # ========================================================================
    # ë¡œê·¸ íŒŒì¼ì˜ ê° ì¤„ì„ ì •ê·œí‘œí˜„ì‹ìœ¼ë¡œ ê²€ì‚¬í•˜ì—¬
    # ê±°ë˜ ì´ë²¤íŠ¸(ë§¤ìˆ˜/ë§¤ë„/ì†ìµ)ë§Œ ì¶”ì¶œí•©ë‹ˆë‹¤.
    #
    # íŒŒì‹± ì „ëµ:
    #   1. íŒŒì¼ì„ í•œ ì¤„ì”© ì½ìŒ (ë©”ëª¨ë¦¬ íš¨ìœ¨ì )
    #   2. ê° íŒ¨í„´ìœ¼ë¡œ ë§¤ì¹­ ì‹œë„
    #   3. ë§¤ì¹­ë˜ë©´ ê·¸ë£¹ì—ì„œ ë°ì´í„° ì¶”ì¶œ
    #   4. ë”•ì…”ë„ˆë¦¬ë¡œ ì €ì¥
    #
    # re.search(pattern, string):
    #   - ë¬¸ìì—´ì—ì„œ íŒ¨í„´ì„ ì°¾ìŒ
    #   - ì°¾ìœ¼ë©´ Match ê°ì²´ ë°˜í™˜, ì—†ìœ¼ë©´ None
    #   - m.group(1): ì²« ë²ˆì§¸ ê´„í˜¸ ê·¸ë£¹ì˜ ê°’
    # ========================================================================
    log_file_path = LOG_DIR / LOG_FILE_FORMAT.format(date_str)
    buy_events = []  # ë§¤ìˆ˜ ì´ë²¤íŠ¸ ì €ì¥
    sell_events = []  # ë§¤ë„/ì²­ì‚° ì´ë²¤íŠ¸ ì €ì¥
    pnl_events = []  # ì†ìµ ì´ë²¤íŠ¸ ì €ì¥

    if not log_file_path.exists():
        logger.warning(f"ë¡œê·¸ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {log_file_path}")
        return buy_events, sell_events, pnl_events

    # íŒŒì¼ì„ ì—´ì–´ì„œ í•œ ì¤„ì”© ì²˜ë¦¬
    with open(log_file_path, "r", encoding="utf-8") as f:
        for line in f:  # í•œ ì¤„ì”© ì½ê¸° (ë©”ëª¨ë¦¬ íš¨ìœ¨ì )
            # ë§¤ìˆ˜ ì£¼ë¬¸ ì ‘ìˆ˜ ì„±ê³µ - íŒ¨í„´ ë§¤ì¹­
            m = BUY_PATTERN.search(line)  # íŒ¨í„´ ê²€ìƒ‰
            if m:  # ë§¤ì¹­ë˜ë©´
                # m.group(n): në²ˆì§¸ ê´„í˜¸ ê·¸ë£¹ì˜ ê°’
                # group(1): íƒ€ì„ìŠ¤íƒ¬í”„, group(2): ì¢…ëª©ëª…, group(3): ìˆ˜ëŸ‰, group(4): ê°€ê²©
                buy_events.append({
                    'time': m.group(1).split(' ')[1],  # "2024-01-15 10:30:00" â†’ "10:30:00"
                    'name': m.group(2),  # ì¢…ëª©ëª…
                    'quantity': int(m.group(3)),  # ìˆ˜ëŸ‰ (ë¬¸ìì—´ â†’ ì •ìˆ˜)
                    'price': m.group(4),  # ê°€ê²© (ì½¤ë§ˆ í¬í•¨ ë¬¸ìì—´)
                })
                continue  # ë‹¤ìŒ ì¤„ë¡œ ì´ë™

            # ë§¤ë„ ì£¼ë¬¸ ì²´ê²° ì„±ê³µ
            m = SELL_PATTERN.search(line)
            if m:
                sell_events.append({
                    'time': m.group(1).split(' ')[1],
                    'name': m.group(2),
                    'quantity': int(m.group(3)),
                    'price': m.group(4),
                    'type': 'ë§¤ë„',
                })
                continue

            # ì²­ì‚° ì£¼ë¬¸ ì²´ê²° ì„±ê³µ
            m = LIQUIDATION_PATTERN.search(line)
            if m:
                sell_events.append({
                    'time': m.group(1).split(' ')[1],
                    'name': m.group(2),
                    'quantity': int(m.group(3)),
                    'price': m.group(5),  # ì²­ì‚°ê°€
                    'type': 'ì²­ì‚°',
                    'entry_price': m.group(4),
                })
                continue

            # ì²­ì‚° ì†ìµ
            m = PNL_PATTERN.search(line)
            if m:
                pnl_events.append({
                    'time': m.group(1).split(' ')[1],
                    'amount': m.group(2),
                    'percent': m.group(3),
                })

    return buy_events, sell_events, pnl_events


def generate_report_content(date_str: str, buy_events: list, sell_events: list,
                            pnl_events: list, summary_data: dict) -> str:
    """
    ë§ˆí¬ë‹¤ìš´ í˜•ì‹ì˜ ì¼ì¼ ë¦¬í¬íŠ¸ ë‚´ìš©ì„ ìƒì„±í•©ë‹ˆë‹¤.

    Args:
        date_str: YYYY-MM-DD í˜•ì‹ì˜ ë‚ ì§œ ë¬¸ìì—´
        buy_events: ë§¤ìˆ˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤íŠ¸
        sell_events: ë§¤ë„/ì²­ì‚° ì´ë²¤íŠ¸ ë¦¬ìŠ¤íŠ¸
        pnl_events: ì†ìµ ì´ë²¤íŠ¸ ë¦¬ìŠ¤íŠ¸
        summary_data: ìš”ì•½ JSON ë°ì´í„°

    Returns:
        ë§ˆí¬ë‹¤ìš´ ë¦¬í¬íŠ¸ ë¬¸ìì—´
    """
    # ========================================================================
    # [í•™ìŠµ í¬ì¸íŠ¸] ë§ˆí¬ë‹¤ìš´ ë¦¬í¬íŠ¸ ìƒì„±
    # ========================================================================
    # ë§ˆí¬ë‹¤ìš´(Markdown)ì€ í…ìŠ¤íŠ¸ë¥¼ ì„œì‹ ìˆëŠ” ë¬¸ì„œë¡œ ë³€í™˜í•˜ëŠ” ê²½ëŸ‰ ë§ˆí¬ì—… ì–¸ì–´ì…ë‹ˆë‹¤.
    #
    # ê¸°ë³¸ ë¬¸ë²•:
    #   # ì œëª©      â†’ <h1> íƒœê·¸
    #   ## ì†Œì œëª©   â†’ <h2> íƒœê·¸
    #   ---        â†’ ìˆ˜í‰ì„ 
    #   **êµµê²Œ**   â†’ <strong> íƒœê·¸
    #   | a | b |  â†’ í…Œì´ë¸”
    #
    # í…Œì´ë¸” ì‘ì„±ë²•:
    #   | í—¤ë”1 | í—¤ë”2 |
    #   |-------|-------|   â† í—¤ë”ì™€ ë³¸ë¬¸ êµ¬ë¶„
    #   | ê°’1   | ê°’2   |
    #
    # ì •ë ¬:
    #   |---:|  â†’ ì˜¤ë¥¸ìª½ ì •ë ¬
    #   |:---|  â†’ ì™¼ìª½ ì •ë ¬
    #   |:--:|  â†’ ê°€ìš´ë° ì •ë ¬
    # ========================================================================
    lines = []  # ê° ì¤„ì„ ë¦¬ìŠ¤íŠ¸ì— ì €ì¥
    lines.append(f"# {date_str} íˆ¬ì ê²°ê³¼ ë¦¬í¬íŠ¸\n")  # ì œëª©
    lines.append("---\n")  # ìˆ˜í‰ì„ 

    # ë§¤ìˆ˜ ê¸°ë¡
    lines.append("## ë§¤ìˆ˜ ê¸°ë¡\n")
    if buy_events:
        lines.append("| ì‹œê°„ | ì¢…ëª© | ìˆ˜ëŸ‰ | ì£¼ë¬¸ê°€ |")
        lines.append("|------|------|-----:|-------:|")
        for e in buy_events:
            lines.append(f"| {e['time']} | {e['name']} | {e['quantity']}ì£¼ | {e['price']}ì› |")
        lines.append("")
    else:
        lines.append("í•´ë‹¹ì¼ì— ë§¤ìˆ˜ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.\n")

    # ë§¤ë„/ì²­ì‚° ê¸°ë¡
    lines.append("## ë§¤ë„/ì²­ì‚° ê¸°ë¡\n")
    if sell_events:
        lines.append("| ì‹œê°„ | ì¢…ëª© | ìœ í˜• | ìˆ˜ëŸ‰ | ì²´ê²°ê°€ |")
        lines.append("|------|------|------|-----:|-------:|")
        for e in sell_events:
            lines.append(f"| {e['time']} | {e['name']} | {e['type']} | {e['quantity']}ì£¼ | {e['price']}ì› |")
        lines.append("")
    else:
        lines.append("í•´ë‹¹ì¼ì— ë§¤ë„/ì²­ì‚° ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.\n")

    # ì†ìµ ê¸°ë¡
    lines.append("## ì†ìµ ê¸°ë¡\n")
    if pnl_events:
        lines.append("| ì‹œê°„ | ì†ìµ | ìˆ˜ìµë¥  |")
        lines.append("|------|-----:|-------:|")
        for e in pnl_events:
            lines.append(f"| {e['time']} | {e['amount']}ì› | {e['percent']}% |")
        lines.append("")
    else:
        lines.append("í•´ë‹¹ì¼ì— ì†ìµ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.\n")

    # ì´í‰ ë° ê²°ê³¼
    lines.append("## ì´í‰ ë° ê²°ê³¼\n")
    lines.append(f"- **ë§¤ìˆ˜ ê±´ìˆ˜**: {len(buy_events)}ê±´")
    lines.append(f"- **ë§¤ë„/ì²­ì‚° ê±´ìˆ˜**: {len(sell_events)}ê±´")

    if summary_data:
        pnl = summary_data.get('daily_pnl', 0)
        final_balance = summary_data.get('final_balance', 0)
        lines.append(f"- **ë‹¹ì¼ ì‹¤í˜„ ì†ìµ**: {pnl:,.0f}ì›")
        lines.append(f"- **ìµœì¢… ê³„ì¢Œ ì”ê³ **: {final_balance:,.0f}ì›")
    else:
        lines.append("- **ë‹¹ì¼ ì‹¤í˜„ ì†ìµ**: ìš”ì•½ ë°ì´í„° ì—†ìŒ")
        lines.append("- **ìµœì¢… ê³„ì¢Œ ì”ê³ **: ìš”ì•½ ë°ì´í„° ì—†ìŒ")

    lines.append("")
    return "\n".join(lines)


def generate_daily_report():
    """
    ì¼ì¼ íˆ¬ì ê²°ê³¼ ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    ì˜¤ëŠ˜ ë‚ ì§œì˜ ë¡œê·¸ íŒŒì¼ê³¼ ìš”ì•½ íŒŒì¼ì„ ì½ì–´ ë§ˆí¬ë‹¤ìš´ ë¦¬í¬íŠ¸ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
    """
    logger.info("ì¼ì¼ íˆ¬ì ê²°ê³¼ ë¦¬í¬íŠ¸ ìƒì„±ì„ ì‹œì‘í•©ë‹ˆë‹¤.")
    setup_reporter()

    now = datetime.now()
    date_str_for_report = now.strftime("%Y-%m-%d")
    date_str_for_log = now.strftime("%Y%m%d")

    report_file_path = REPORT_DIR / REPORT_FILE_FORMAT.format(date_str_for_report)

    try:
        buy_events, sell_events, pnl_events = parse_log_file(date_str_for_log)
        summary_data = parse_summary_file(date_str_for_log)

        report_content = generate_report_content(
            date_str_for_report, buy_events, sell_events, pnl_events, summary_data
        )

        with open(report_file_path, "w", encoding="utf-8") as f:
            f.write(report_content)

        logger.info(f"ì¼ì¼ íˆ¬ì ê²°ê³¼ ë¦¬í¬íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤: {report_file_path}")

    except Exception as e:
        logger.error(f"ë¦¬í¬íŠ¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}")


if __name__ == "__main__":
    logging.basicConfig(
        level=logging.INFO,
        format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
    )
    generate_daily_report()
